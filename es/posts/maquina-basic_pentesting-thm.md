[English](https://emersontech.github.io/en/index.html)|[Inicio](https://emersontech.github.io/index.html)|[Contenido](https://emersontech.github.io/es/nav/page1.html)|[Autor](https://emersontech.github.io/es/nav/about.html)|[Linkedin](https://www.linkedin.com/in/emersontech/)

# Resolviendo la Máquina Basic Pentesting de TryHackMe

## Resumen de la Máquina
La máquina Basic Pentesting es una máquina de la plataforma de tryhackme de dificultad fácil. Su enumeración con la herramienta de **nmap** nos muestra determinados puertos abiertos con los cuales iremos explotando a medida que logremos avanzar en la auditoría. Como estamos en una auditoría y nos encontramos un servicio web **http** corriendo en el **puerto 80 abierto podemos enumerar subdominios con wfuzz**. Tambien se nos revela una **vulnerabilidad de weak password** de un determinado usuario. Por último lograremos una escalada de privilegios laterales por mediante el decifirado de llaves **id_rsa mediante herramientas de password cracking como zip2john.**

Cabe mencionar que por motivos del servidor, tryhackme nos cambiará la dirección ip que estaremos auditando.

[Lista de máquinas completas](https://emersontech.github.io/es/posts/tabla-de-maquinas-completadas.html)

## Herramientas y Técnicas Utilizadas
- Ping
- Nmap
- Web Browser
- Searchsploit
- Whatweb
- Wfuzz 
- Smbclient / enum4linux
- SSH / SCP
- Hydra
- John

## Comprometiendo la Máquina

Comenzamos la auditoria comprobando el estado de nuestra maquina objetivo utilizando un **ping** con el motivo de comprobar respuesta de nuestro objetivo.

![img](/img/BasicPentest/0.png)

Los resultados han arrojado un **time to live (TTL = 61)** lo que indica, gracias a proximidad, que nos encontramos frente a un objetivo Linux.

Gracias a la utilidad de **traceroute** podemos monitorear por donde viaja nuestra solicitud incluyendo el servidor nodo que funciona de intermediario entre la comunicacion:

![img](/img/BasicPentest/1.png)

Comenzamos con la fase de reconocimiento utilizando nuestra herramienta de nmap en direccion hacia nuestra maquina objetivo utilizando los paramentros:

![img](/img/BasicPentest/2.png)

El resultado nos mostro diferentes puertos abiertos, como estamos ante un puerto 80 accedemos al servicio http dentro de la **URL (Uniform Resource Locator).** Otro puerto que es imporante destacar es el **puerto 8080 http-proxy**. Lo que indicaria otra forma de acceder hacia el contenido web.

En nuestro segundo escaneo agregamos diferentes parametros para tener más información que pueda resultarnos de ayuda utliizando los paraémtros:

![img](/img/BasicPentest/3.png)

Como no tenemos nada que nos llame la atención realizamos un último escaneo, esta vez analizando cada puerto expuesto junto con el motor de scripts que viene por defecto en nmap:

![img](/img/BasicPentest/4.png)

Lo que nos interesa en este punto es que encontramos las versiones sobre el servicio **http puerto 80** corriendo un **Apache 2.4.18, Apache Tomcat 9.0.7.**

Como en el informe anterior logramos encontrar ciertas versiones, podemos realizar una busqueda rápida en **searchsploit.**

![img](/img/BasicPentest/5.png)
![img](/img/BasicPentest/6.png)
![img](/img/BasicPentest/7.png)

Con la información obtenida ya sabemos que no podemos utilizar **searchsploit** para encontrar una potencial via de ataque.

Como sabemos que estamos ante un **puerto http 80 abierto** logramos ingresar la direccion ip por el navegador y llegamos hacia una página web en mantenimiento:

![img](/img/BasicPentest/8.png)

Si aplicamos una inspeccion de su codigo fuente no encontraremos ninguna via de ataque: 

![img](/img/BasicPentest/9.png)

Antes de realizar fuzzing web es necesario analizar las tecnologías que corren detrás de la misma web:

![img](/img/BasicPentest/10.png)

Como estamos ante una pagina web corresponde realizar un fuzzing web para encontrar contenido oculto, esta vez utilizaremos wfuzz y el primer resultado que encontramos es el directorio /development.

![img](/img/BasicPentest/11.png)
![img](/img/BasicPentest/12.png)

El introducirlo directamente en la URL podemos notar ciertos archivos que valen la pena analizarlos. Otro punto importante a notar en la captura anterior es la version de apache que esta siendo utilizada **apache 2.4.18** aun que esto tambien podemos saberlo gracias a utilizar **wappalyzer.**

Al ingresar al archivo **dev.txt** podemos notar el siguente archivo de texto:

![img](/img/BasicPentest/13.png)

Mientras que en el archivo J.txt encontramos:

![img](/img/BasicPentest/14.png)

En el texto anterior logramos encontrar un punto critico en cuanto a romper un **hash** facilmente, si recordamos anteriormente tenemos un **puerto 22 ssh abierto.** 

Como en el escaneo anterior de **nmap** notamos un puerto expuesto **8080 http-proxy** podemos ingresarlo en la URL como **http://10.10.189.107:8080** para encontrar algun vector de ataque:

![img](/img/BasicPentest/15.png)

Aquello nos llevo directamente hacia un servidor web Apache Tomcat 9.0.7. Como no es lo mismo aplicar fuzzing web hacia la IP 10.10.221.123 que 10.10.221.123:8080 (especificando el puerto), corresponde hacer nuevamente un fuzzing web:

![img](/img/BasicPentest/16.png)
![img](/img/BasicPentest/17.png)

Aquello nos mostro un directorio interesante el cual es manager que al ingresarlo directamente en la URL nos lleva hacia un panel de autenticación:

![img](/img/BasicPentest/18.png)

Un repositorio en github nos provee directamente de credenciales para apache tomcat que viene por defecto.

https://github.com/netbiosX/Default-Credentials/blob/master/Apache-Tomcat-Default-Passwords.mdown

![img](/img/BasicPentest/19.png)

Luego de estar intentando credenciales no logramos ingresar con exito hacia el panel de manager.

Como anteriormente vimos en nuestros escaneos de **nmap** observamos el servicio **smb** se encontraba abierto, entonces si usamos el comando **smbclient** que viene instalado en linux y especificamos el parametro **-L** para listar los **hosts** podemos ver que se encuentra el **sharename de Anonymous** disponible:

![img](/img/BasicPentest/20.png)

Una busqueda en google nos explica como conectarnos desde nuestra maquina kali hacia el recurso compartido.

https://bestestredteam.com/2019/03/15/using-smbclient-to-enumerate-shares/

Un recorrido dentro del directorio nos muestra el archivo staff.txt que podemos descargar utilizando el **comando get**:

![img](/img/BasicPentest/21.png)

Al abrir el archivo con un cat podemos observar un anuncio hacia el staff, lo que nos muestra exactamente dos nombres Kay y Jan.

![img](/img/BasicPentest/22.png)

Como analizamos anteriormente sabemos que existen credenciales débiles y tambien tenemos la presencia de un puerto 20 ssh expuesto lo que indica una via de ataque. Utilizamos las credenciales que tenemos e intentamos conectarnos al servicio ssh.

![img](/img/BasicPentest/23.png)

Luego de algunos intentos de credenciales débiles notamos que no podemos tener acceso, es por eso que utilizaremos **hydra** para romper esta contraseña ya que sabemos que es débil debido a la carta hacia el departamento de **development.**

Con la ayuda de la herramienta **hydra** podemos realizar un **password cracking junto con la wordlist rockyou** y efectivamente logramos obtener acceso hacia el usuario **Jan por el protocolo ssh.**

![img](/img/BasicPentest/24.png)

Ahora sabemos que las credenciales para tener acceso por ssh esta dado por jan:armando. Una vez introducidas las credenciales podemos navegar por el sistema de archivos.

**NOTA IMPORTANTE: EN ESTE PUNTO DE LA AUDITORIA FUE CAMBIADA LA DIRECCIÓN IP DEBIDO AL TIEMPO DE EXPIRACIÓN DE LA MAQUINA. AHORA ES LA IP 10.10.204.158**

![img](/img/BasicPentest/25.png)

Llegados hasta este punto realizamos los tipicos comandos de reconocimiento ante la máquina remota: whoami, sudo -l, hostname, id.

![img](/img/BasicPentest/26.png)

Como no tenemos los suficientes permisos de super usuario, nos vemos obligados a intentar una escalada de privilegios lateral. Es por ello que indagando dentro de los archivos del directorio Kay logramos encontrar las llaves id_rsa.

![img](/img/BasicPentest/27.png)
![img](/img/BasicPentest/28.png)
![img](/img/BasicPentest/29.png)

Como nos interesa extraer la llave **id_rsa** podemos realizarlo de diferentes formas:

1. Utilizar un comando que sirve para descargar archivos utilizando el protocolo **ssh**:
**scp (username)@(ip):(path_of_the_file) .
![img](/img/BasicPentest/30.png)

2. Realizar un copy & paste del id_rsa utilizando nano:
![img](/img/BasicPentest/31.png)

Como podemos ver tenemos nuestro **id_rsa** que descargamos directamente de nuestra victima, como el archivo **key** que lo creamos utilizando **nano.** Aun que es más recomendable descargar el archivo con el primer comando.

Una vez obtenido el archivo nos interesa pasar nuestra key descargada, en este caso estoy utilizando la misma **id_rsa** hacia un archivo de texto plano para poder realizar un **ataque de fuerza bruta con la herramienta john.**

En este caso estoy pasando la llave **id_rsa hacia un id.txt**

![img](/img/BasicPentest/32.png)

Utilizando la herramienta john junto con una wordlist en este caso la wordlist famosa de rockyou y entregando el archivo de texto plano id.txt comenzamos el ataque.

![img](/img/BasicPentest/33.png)

Como tenemos una llave id_rsa no nos servira de mucho utilizar la misma contraseña para ingresar unicamente hacia el usuario kay ya que esta llave cumple con la funcion de token. Entonces, en este caso otorgamos permisos chmod 600

![img](/img/BasicPentest/34.png)

Utilizando los parametros adecuados logramos entrar en el usuario kay.

![img](/img/BasicPentest/35.png)

Buscando dentro de los archivos, realizamos un cat al archivo pass.bak y obtenemos la flag.

![img](/img/BasicPentest/36.png)

### Redes Sociales

![img](/img/linkedin.png)|[Linkedin](https://www.linkedin.com/in/emersontech/)|![img](/img/youtube.png)|[Youtube](https://www.youtube.com/channel/UChNTj2xNpEQiliMv-IJbWvQ)|![img](/img/github.png)|[Github](https://github.com/emersontech)
